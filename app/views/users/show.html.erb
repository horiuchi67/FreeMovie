
<% if flash[:notice] %>
  <div class="flash">
    <p><%= flash[:notice] %></p>
  </div>
<% end %>
<div class="col-xs-3">
	<h3>ユーザー情報</h3>
	<%= render 'info', user: @user,now: ''%>
	<h3>新規投稿</h3>
	<%= render 'books/form', book: @book %>
	<% if @user.id == current_user.id %><br><% end %>
</div>
<div class="col-xs-9">
	<h3>ユーザーの書籍感想一覧</h3>
	<table class="table table-hover table-inverse">
   	    <thead>
		    <tr>
		        <th></th>
		        <th>タイトル</th>
		        <th>感想</th>
		        <th colspan="3"></th>
		    </tr>
	    </thead>
	    <tbody>
	        <% @books.each do |book| %>
		        <% if book.user == @user %>
					<tr>
						<td><%= attachment_image_tag @user, :profile_image, :fill, 20, 20, format: 'jpeg', class: " pull-left ", fallback: "no-image-icon.jpg" %> </td>
						<td class="book-title1"><%= link_to book.title, book_path(book) %></td>
						<td ><%= book.body %></td>
						<td><%= book.book_comments.count %>件コメント</td>
					</tr>
		        <% end %>
		     <% end %>
	    </tbody>
	</table>
</div>
<div>
<% if @user.id == current_user.id %>
	<div class="container">
		<script type="text/javascript">
		  function initMap() {
		    var test ={lat: <%= @user.latitude %>, lng: <%= @user.longitude %>};
		    var map = new google.maps.Map(document.getElementById('map'), {
		              zoom: 15, 
		              center: test
		              });
		    var transitLayer = new google.maps.TransitLayer();
		    transitLayer.setMap(map);

		    var contentString = '住所：<%= @user.address %>';
		    var infowindow = new google.maps.InfoWindow({
		      content: contentString
		    });


		    var marker = new google.maps.Marker({
		                  position:test,
		                  map: map,
		                  title: contentString
		                 });

		     marker.addListener('click', function() {
		       infowindow.open(map, marker);
		     });
		  }
		</script>

		<script async defer
  				src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['API_KEY'] %>&callback=initMap">
		</script>
		<style type="text/css">
		  #map { height: 300px;
		         width: 90%;}
		</style>

		<div id="map"></div>
	</div>
<% end %>
</div>
